{% extends "layout.html" %}
{% block body %}

<h2>Combat resuts:</h2>
<table class="fg2">
    <tr class="gris">
        <th class="fg2">{{ s1.name }}</th>
        <th>&nbsp;&nbsp;</th>
        <th class="fg2">{{ s2.name }}</th>
    </tr>
    <tr>
        <td class="fg2">dice({{ p1_dice }}) + mod({{ p1_mod }})</td>
        <td></td>
        <td class="fg2">dice({{ p2_dice }}) + mod({{ p2_mod }})</td>
    </tr>
</table>
{% if winner == 1 %}
    <p><b>{{ s1.name }} wins!</b></p>
    <ul>
        <li>
            <b>Damage:</b> dice({{ p1_dice }}) + mod({{ p1_mod }}) + weapon_mod({{wp1 }}) - armour({{ a2 }}) = <b>{{ damage2 }}</b>
        </li>
        <li>
            <b>{{ s2.name }} Health:</b> {{ health2 }} - {{ damage2 }} = <b>{{ new_health2 }}</b>
        </li>
    </ul>
    {% if new_health2 == 0 %}
        <p style="color:red"> <b>{{ s2.name }} KILLED!</b></p>
    {% endif %}    

{% elif winner == 2 %}

    <p><b>{{ s2.name }} wins!</b></p>
        <ul>
            <li>
                <b>Damage:</b> dice({{ p2_dice }}) + mod({{ p2_mod }}) + weapon_mod({{ wp2 }}) - armour({{ a1 }}) = <b>{{ damage1 }}</b>
            </li>
            <li>
                <b>{{ s1.name }} Health:</b> {{ health1 }} - {{ damage1 }} = <b>{{ new_health1 }}</b>
            </li>
        </ul>
        {% if new_health1 == 0 %}
            <p style="color:red"> <b>{{ s1.name }} KILLED!</b></p>
        {% endif %} 
{% elif winner == 0 %}

        <p><b>Draw!</b></p>
        <ul>
            <li>
                <b>Damage:</b> dice({{ p1_dice }}) + mod({{ p1_mod }}) + weapon_mod({{wp1 }}) - armour({{ a2 }}) = <b>{{ damage2 }}</b>
            </li>
            <li>
                <b>{{ s2.name }} health:</b> {{ health2 }} - {{ damage2 }} = <b>{{ new_health2 }}</b>
            </li>
            <li>
               <b>Damage:</b> dice({{ p2_dice }}) + mod({{ p2_mod }}) + weapon_mod({{wp2 }}) - armour({{ a1 }}) = <b>{{ damage1 }}</b>
            </li>
            <li>
                <b>{{ s1.name }} health:</b> {{ health1 }} - {{ damage1 }} = <b>{{ new_health1 }}</b>
            </li>
        </ul>
        {% if new_health2 == 0 %}
            <p style="color:red"><b>{{ s2.name }} KILLED!</b></p>
        {% endif %}   
        {% if new_health1 == 0 %}
            <p style="color:red"><b>{{ s1.name }} KILLED!</b></p>
        {% endif %}        
    {% endif %}


<form action="{{ url_for('apply_new_health') }}" method=post class=add-task>
    <input type="hidden" id="use_mini1" name="use_mini1" value="1">
    <input type="hidden" id="mini1" name="mini1" value={{ s1.rowid }}>
    <input type="hidden" id="health1" name="health1" value={{ new_health1 }}>
    <input type="hidden" id="use_mini2" name="use_mini2" value="1">
    <input type="hidden" id="mini2" name="mini2" value={{ s2.rowid }}>
    <input type="hidden" id="health2" name="health2" value={{ new_health2 }}>
    <input type="submit" value="Apply">
</form>

{% endblock%}