{% extends "layout.html" %}
{% block body %}
<script>
    function change_damage1(){
        var damage = document.getElementById("damage1_input").value;
        var health = {{ health1 }};
        document.getElementById("damage1_p").innerHTML= damage;
        document.getElementById("health1").value = health - parseInt(damage);
        document.getElementById("health1_p").innerHTML = (health - parseInt(damage)).toString();
    }
    function change_damage2(){
        var damage = document.getElementById("damage2_input").value;
        var health = {{ health2 }};
        document.getElementById("damage2_p").innerHTML= damage;
        document.getElementById("health2").value = health - parseInt(damage);
        document.getElementById("health2_p").innerHTML = (health - parseInt(damage)).toString();
    }
</script>

<h2>Combat resuts:</h2>
<form action="{{ url_for('apply_new_health') }}" method=post class=add-task>
 
<table class="fg2">
    <tr class="gris">
        <th class="fg2">{{ s1.name }}</th>
        <th>&nbsp;&nbsp;</th>
        <th class="fg2">{{ s2.name }}</th>
    </tr>
    <tr>
        <td class="fg2">dice({{ p1_dice }}) + mod({{ p1_mod }})</td>
        <td></td>
        <td class="fg2">dice({{ p2_dice }}) + mod({{ p2_mod }})</td>
    </tr>
</table>

{% if winner == 1 %}
    <p><b>{{ s1.name }} wins!</b></p>
{% elif winner == 2 %}
    <p><b>{{ s2.name }} wins!</b></p>
{% elif winner == 0 %}
    <p><b>Draw!</b></p>
{% endif %}

{% if winner == 1 or winner == 0 %}
    <ul>
        <li>
            <b>Damage:</b> dice({{ p1_dice }}) + mod({{ p1_mod }}) + weapon_mod({{wp1 }}) - armour({{ a2 }}) = 
            <input onchange="change_damage2()" type="number" id="damage2_input" name="damage2_input" min=0 max=50 value={{ damage2 }} >
        </li>
        <li>
            <b>{{ s2.name }} Health:</b> {{ health2 }} - <span id="damage2_p">{{ damage2 }}</span> =  <span id="health2_p">{{ health2 }}</span>
        </li>
    </ul>
  
{% endif %}
{% if winner == 2 or winner == 0 %}
    <ul>
        <li>
            <b>Damage:</b> dice({{ p2_dice }}) + mod({{ p2_mod }}) + weapon_mod({{ wp2 }}) - armour({{ a1 }}) = 
            <input  onchange="change_damage1()" type="number" id="damage1_input" name="damage1_input" min=0 max=50 value={{ damage1 }}>
        </li>
        <li>
            <b>{{ s1.name }} Health:</b> {{ health1 }} - <span id="damage1_p">{{ damage1 }}</span> = <span id="health1_p">{{ health1 }}</span>
        </li>
    </ul>
    
{% endif %}
    <input type="hidden" id="health1" name="health1" value={{ new_health1 }}>
    <input type="hidden" id="health2" name="health2" value={{ new_health2 }}>
    <input type="hidden" id="use_mini1" name="use_mini1" value="1">
    <input type="hidden" id="mini1" name="mini1" value={{ s1.rowid }}> 
    <input type="hidden" id="use_mini2" name="use_mini2" value="1">
    <input type="hidden" id="mini2" name="mini2" value={{ s2.rowid }}>
    <input type="submit" value="Apply">
</form>

{% endblock%}
